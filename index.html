<!DOCTYPE html>
<html lang="en" ng-app="listaTelefonica">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Angularjs - Lista telefonica</title>
  
  <!-- CSS -->
  <link rel="stylesheet" href="./node_modules/bootstrap/dist/css/bootstrap.min.css">
</head>
<body ng-controller="listaTelefonicaCtrl">  
  <div class="p-3 mb-2 bg-secondary bg-gradient text-white text-center">
    <h4>{{ app }}</h4>
  </div>

  <div class="container-fluid">
    <div class="row">
      <div class="col-md-4 offset-md-4">
        <table ng-show="contatos.length" class="table table-striped text-center">
          <thead>
            <tr>
              <th></th>
              <th>Nome</th>
              <th>Telefone</th>
              <th>Operadora</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr ng-class="{'bg-warning': contato.selecionado }" ng-repeat="contato in contatos track by $index">
              <td>
                <input type="checkbox" ng-model="contato.selecionado">
              </td>
              <td>{{ contato.nome }}</td>
              <td>{{ contato.telefone }}</td>
              <td>{{ contato.operadora.nome }}</td>
              <td>
                <div 
                  style="width:20px; height: 20px;" 
                  ng-style="{'background-color': contato.cor}"
                  ng-hide="contato.selecionado"
                  >
                  </div>
              </td>
            </tr>
          </tbody>
        </table>

        <hr>

        <form name="contatoForm">
          <div class="row mb-3">
            <div class="col-sm-12">
              <input 
                type="text"
                name="nome"
                class="form-control" 
                placeholder="Nome"
                ng-model="contato.nome"
                ng-minlength="2"
                ng-maxlength="20"
                ng-required="true"
              >
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-sm-12">
              <input 
                type="text"
                name="telefone"
                class="form-control"
                placeholder="Telefone"
                ng-model="contato.telefone"
                ng-minlength="8"
                ng-maxlength="9"
                ng-pattern="/^\d{4,5}-\d{4}$/"
                ng-required="true"
              >
            </div>
          </div>

          <!-- OPERADORA -->
          <div class="row mb-3">
            <div class="col-sm-12">
              <select 
                class="form-control"
                ng-model="contato.operadora" 
                ng-options="operadora.nome for operadora in operadoras"
              >
                <option value="">Selecione uma Operadora</option>
              </select>
            </div>
          </div>

          <div ng-messages="contatoForm.nome.$error" class="alert alert-danger" role="alert">
            <!-- NOME - MSG ERRO: REQUIRED -->
            <div ng-message="required">
              Por favor, preencha o nome!
            </div>

            <!-- NOME - MSG ERRO: MINLENGTH (2) -->
            <div ng-show="minlength" >
              O nome deve ter pelo menos 2 caracteres
            </div>
          </div>

          

          <!-- TELEFONE - MSG ERRO: REQUIRED -->
          <div
            ng-show="contatoForm.telefone.$error.required && contatoForm.telefone.$dirty"
            class="alert alert-danger"
            role="alert"
          >
            Por favor, preencha o telefone!
          </div>

          <!-- TELEFONE - MSG ERRO: PATTERN -->
          <div
            ng-show="contatoForm.telefone.$error.pattern"
            class="alert alert-danger"
            role="alert"
          >
            O campo telefone deve ter o formato XXXXX-XXXX
          </div>

          <div class="row mb-3">
            <div class="d-grid gap-0 col-12 mx-auto">
              <button 
                class="btn btn-success" 
                ng-click="adicionarContato(contato)"
                ng-disabled="contatoForm.$invalid"
                >Salvar</button>
            </div>
          </div>

          <div class="row mb-3">
            <div class="d-grid gap-0 col-12 mx-auto">
              <button 
                class="btn btn-danger" 
                ng-click="apagarContatos(contatos)"
                ng-if="isContatoSelecionado(contatos)"
                >Remover</button>
            </div>
          </div>
          </form>
      </div>
    </div>
  </div>
  <div ng-include="'./footer.html'"></div>

  <!-- SCRIPTS -->
  <script src="./node_modules/angular/angular.js"></script>
  <script src="./angular-messages.js"></script>
  <script src="./node_modules/bootstrap/dist/js/bootstrap.js"></script>
  <script>
    angular.module('listaTelefonica',['ngMessages']);
    angular.module('listaTelefonica')
    .controller('listaTelefonicaCtrl', function($scope) {
      $scope.app = 'Lista Telefonica';
      $scope.contatos = [
        {nome: 'Pedro', telefone:'99999999', cor: 'orange'},
        {nome: 'Maria', telefone:'88888888', cor: 'red'},
        {nome: 'Jos√©', telefone:'77777777',cor: 'cyan'}
      ];

      $scope.operadoras = [
        { nome:'Oi', cod: '14', categoria:'Celular' },
        { nome:'Vivo', cod: '15', categoria:'Celular'},
        { nome:'Tim', cod: '41', categoria:'Celular'},
        { nome:'GVT', cod: '25', categoria:'Fixo'},
        { nome:'Embrael', cod: '21', categoria:'Fixo'}
      ];

      $scope.adicionarContato = function(contato) {
        $scope.contatos.push(angular.copy(contato));
        delete $scope.contato;
        $scope.contatoForm.$setPristine();
      }

      $scope.apagarContatos = function(contatos) {
        $scope.contatos = contatos.filter(function(e) {
          return !e.selecionado;
        });
      }

      $scope.isContatoSelecionado = function(contatos) {
        return contatos.some(function(contato){
          return contato.selecionado;
        });
      }
    });
  </script>
</body>
</html>